# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a **TanStack Start** full-stack React application with Prisma database integration, deployed to Vercel. It uses file-based routing, server-side rendering, and includes demo examples for TanStack ecosystem features.

## Development Commands

### Core Development
```bash
npm run dev              # Start dev server on port 3000
npm run build            # Build for production
npm run preview          # Preview production build
npm test                 # Run tests with Vitest
```

### Linting & Formatting
```bash
npm run lint             # Run Biome linter
npm run format           # Format code with Biome
npm run check            # Run all Biome checks
```

### Database Operations
All Prisma commands require `.env.local` with `DATABASE_URL`:

```bash
npm run db:generate      # Generate Prisma client
npm run db:push          # Push schema to database (no migrations)
npm run db:migrate       # Create and run migrations
npm run db:studio        # Open Prisma Studio GUI
npm run db:seed          # Seed database with example data
```

### UI Components
```bash
pnpm dlx shadcn@latest add <component>  # Add Shadcn components
```

## Architecture

### Stack Configuration
- **Runtime**: TanStack Start with SSR and SPA modes
- **Router**: File-based routing (`src/routes/`)
- **State**: TanStack Query + TanStack Store
- **Database**: PostgreSQL via Prisma with pg adapter
- **Styling**: Tailwind CSS v4 + Shadcn UI
- **Linting**: Biome (tabs, double quotes)


### Key Patterns

#### 1. Router Integration
The router is created in `src/router.tsx` with TanStack Query SSR integration:
- Routes are file-based in `src/routes/`
- `routeTree.gen.ts` is auto-generated (excluded from linting)
- Query client is passed via router context
- Default preload strategy: `intent`

#### 2. Prisma Setup
- Client generated to `src/generated/prisma/` (custom output location)
- Uses PostgreSQL adapter (`@prisma/adapter-pg`)
- Global singleton pattern in `src/db.ts` prevents connection pool exhaustion
- Seed file: `prisma/seed.ts` (run with `npm run db:seed`)

#### 3. TanStack Query Integration
- Query client created in `src/integrations/tanstack-query/root-provider.tsx`
- Injected into router context for SSR compatibility
- Wrapped around router in `__root.tsx`

#### 4. TanStack DB Collections
Local-first data collections in `src/db-collections/`:
- Use Zod schemas for validation
- Example: `messagesCollection` for chat features
- Pattern: `createCollection()` with `localOnlyCollectionOptions()`

#### 5. Route Structure
Routes live in `src/routes/`:
- `__root.tsx`: Root layout with devtools and meta tags
- `index.tsx`: Homepage
- `demo/`: Example implementations of TanStack features
- File naming: `demo.feature.tsx` for demo routes

#### 6. Devtools Integration
All TanStack devtools unified in `__root.tsx`:
- Router, Query, Store, and AI devtools
- Custom plugins for each TanStack tool
- Position: bottom-right

### Environment Variables
Required in `.env.local`:
- `DATABASE_URL`: PostgreSQL connection string
- `ANTHROPIC_API_KEY`: For AI features (optional)

### Path Aliases
`@/*` maps to `src/*` (configured in `tsconfig.json` + `vite-tsconfig-paths`)

### Important Notes
- **Demo files**: Files prefixed with `demo` are examples and can be deleted
- **Generated files**: `src/routeTree.gen.ts` is auto-generated by TanStack Router
- **Biome config**: Uses tabs for indentation, double quotes for strings
- **React Compiler**: Enabled via babel plugin for optimizations
- **Node version**: Project targets Node 22+ (warnings on Node 20 are non-critical)
